<div class="sidebar">
    <p-tree
        [value]="files"
        selectionMode="single"
        [(selection)]="selectedCategory"
        (onNodeSelect)="filterCategory($event)"
        (onNodeCollapse)="collapseCategory($event)"
        (onNodeContextMenuSelect)="setContextMenuCategory($event)"
        [draggableNodes]="true"
        [droppableNodes]="true"
        [contextMenu]="groupCm">
        <ng-template let-node pTemplate="default">
            <input
                *ngIf="isRenameModeOn && node === contextSelectedCategory; else readOnly"
                [(ngModel)]="node.label"
                (blur)="setRenameModeOff()"
                type="text"
                appBlurEnter
                class="group-name-input"
                maxlength="20">
            <ng-template #readOnly>
                <div appDroppable>
                    {{ node.label }}
                    <input type="hidden" class="node-id" [value]="node.key">
                </div>
            </ng-template>
        </ng-template>
    </p-tree>
    <button
        pButton
        type="button"
        class="ui-button-secondary"
        icon="pi pi-plus"
        iconPos="left"
        label="Add group"
        (click)="addGroup()"
        style="display: block; width: 8rem; margin: 0 auto">
    </button>
    <div class="selected-entries">Selected {{ selectedRow.length }} of {{ selectedCategory.data.length }}</div>
</div>
<div class="password-table">
    <div class="table-body">
        <p-table
            [value]="passwordList$ | async"
            [rowTrackBy]="trackByFn"
            [contextMenu]="entryCm"
            (onContextMenuSelect)="selectRowContext($event.data)">
            <ng-template pTemplate="header">
                <tr>
                    <th>Title</th>
                    <th>Username</th>
                    <th>Password</th>
                    <th>URL</th>
                    <th>Notes</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body"
                let-rowData
                let-rowIndex="rowIndex">
                <tr *ngIf="rowData.isCatalog; else regularTemplate"><td colspan="5">{{ rowData.name }}</td></tr>
                <ng-template #regularTemplate>
                    <tr
                        pDraggable
                        [pContextMenuRow]="rowData"
                        [pContextMenuRowIndex]="rowIndex"
                        (onDragStart)="handleDragStart($event, rowData)"
                        (onDragEnd)="handleDragEnd($event)"
                        (click)="selectRow($event, rowData)"
                        class="row-entry"
                        [ngClass]="{'ui-state-highlight': isRowSelected(rowData), 'is-dragging': isRowDragged(rowData)}">
                        <td
                            [appTextEmphasize]="searchPhrase$ | async"
                            (dblclick)="copyToClipboard(rowData, rowData.title)"
                            class="long-text">
                            {{rowData.title}}
                        </td>
                        <td
                            [appTextEmphasize]="searchPhrase$ | async"
                            (dblclick)="copyToClipboard(rowData, rowData.username)"
                            class="long-text">
                            {{rowData.username}}
                        </td>
                        <td (dblclick)="copyToClipboard(rowData, rowData.value)">******</td>
                        <td
                            [appTextEmphasize]="searchPhrase$ | async"
                            (dblclick)="copyToClipboard(rowData, rowData.url)"
                            class="long-text">
                            {{rowData.url}}
                        </td>
                        <td (dblclick)="copyToClipboard(rowData, rowData.notes)" class="long-text">{{rowData.notes}}</td>
                    </tr>
                </ng-template>
            </ng-template>
        </p-table>
        <div *ngIf="!(passwordList$ | async)?.length" class="list-cta">
            Nothing in here, try to&nbsp;<strong>add</strong>&nbsp;a new entry
        </div>
    </div>
    <app-entry-details @myInsertRemoveTrigger *ngIf="selectedRow.length === 1"></app-entry-details>
</div>

<p-contextMenu
    #groupCm
    [model]="selectedGroupLabel === 'Database' ? undefined : groupContextMenuItems"
    styleClass="groupContextmenu">
</p-contextMenu>

<p-contextMenu
    #entryCm
    [model]="selectedRow.length === 1 ? entryMenuItems : multiEntryMenuItems"
    styleClass="entry-contextmenu">
</p-contextMenu>
