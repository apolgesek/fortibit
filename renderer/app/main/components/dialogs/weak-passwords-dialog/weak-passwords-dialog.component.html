<app-modal *ngIf="lastReportLoaded">
  <div class="dialog-header">
    <h2>Weak passwords report</h2>
    <a
      href="#"
      role="button"
      aria-label="Close"
      class="close-dialog"
      (click)="close(); false">&times;
    </a>
  </div>
  <div class="dialog-message">
    <div style="display: flex; margin-top: 2rem;">
      <div *ngIf="!scanInProgress" style="margin-right: 5rem;">
        <button
          type="button"
          appAutofocus
          class="scan-btn primary-btn"
          (click)="scan()">Scan 
        </button>
      </div>
      <div *ngIf="lastReport" class="report-container">
        <div class="last-report">
          <p class="bold">Last scan:</p>
          <p>Date: {{ lastReport.creationDate | date: "dd/MM/yy HH:mm" }}</p>
          <p>Weak passwords count: {{ weakPasswordsFound.length }}</p>
          <a *ngIf="weakPasswordsFound.length" href="#" (click)="showDetails = true; false">
            Show details
          </a>
        </div>
      </div>
    </div>
    <ng-container *ngIf="scanInProgress === false">
      <div *ngIf="weakPasswordsFound.length; else notFound" class="result warning">
        <div class="status"><i class="pi pi-info-circle"></i>
          Found {{ weakPasswordsFound.length }} weak <span [ngPlural]="weakPasswordsFound.length">
            <ng-template ngPluralCase="=1">&nbsp;password</ng-template>
            <ng-template ngPluralCase="other">&nbsp;passwords</ng-template>
          </span>.
        </div>
      </div>
      <ng-template #notFound>
        <ng-container *ngIf="showError; else notFoundSuccess">
          <div class="result warning">
            There was an error scanning for weak passwords.
          </div>
        </ng-container>
        <ng-template #notFoundSuccess>
          <div class="result success">
            <div class="status"><i class="pi pi-check-circle"></i> You're all good.</div>
            <p>No weak passwords have been found.</p>
          </div>
        </ng-template>
      </ng-template>
    </ng-container>
    <ng-container *ngIf="scanInProgress">
      <div class="result row">
        <div class="lds-ring"><div></div><div></div><div></div><div></div></div>Scanning... Please wait.
      </div>
    </ng-container>
    <div *ngIf="showDetails && !scanInProgress">
      <div class="table">
        <div class="table-header">
          <div class="row">
            <div class="col">Group</div>
            <div class="col">Title</div>
            <div class="col">Username</div>
            <div>Score</div>
          </div>
        </div>
        <div class="table-body">
          <div *ngFor="let row of weakPasswordsFound" class="row">
            <div class="col">{{ row.groupName }}</div>
            <div class="col">{{ row.title }}</div>
            <div class="col">{{ row.username }}</div>
            <div>
              <div class="score level-{{ row.score }}" [ngSwitch]="row.score">
                <ng-container *ngSwitchCase="0">Very weak</ng-container>
                <ng-container *ngSwitchCase="1">Very weak</ng-container>
                <ng-container *ngSwitchCase="2">Weak</ng-container>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer-container">
    <button
      type="button"
      class="text-btn"
      (click)="close()">
      Close
    </button>
  </div>
</app-modal>