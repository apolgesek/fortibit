<app-modal *ngIf="lastReportLoaded">
  <div class="dialog-header">
    <h2>Check exposed passwords</h2>
    <a
      href="#"
      role="button"
      aria-label="Close"
      class="close-dialog"
      (click)="close(); false">&times;
    </a>
  </div>
  <div class="dialog-message">
    <p>Identify passwords that have been compromised in publicly available leaks. The web service implements k-anonymity model that
      allows password to be searched by a partial hash without disclosing the searched password. 
      Courtesy of <a href="#" (click)="openUrl('http://haveibeenpwned.com'); false;">haveibeenpwned.com</a>.</p>
    <div style="display: flex; margin-top: 2rem;">
      <div *ngIf="!scanInProgress" style="margin-right: 5rem;">
        <button
          type="button"
          appAutofocus
          class="scan-btn primary-btn"
          (click)="scan()">Quick scan
      </button>
      </div>
      <div *ngIf="lastReport" class="report-container">
        <div class="last-report">
          <p class="bold">Last scan:</p>
          <p>Date: {{ lastReport.creationDate | date: 'medium' }}</p>
          <p>Duration: {{ lastReport.generationTime }}s</p>
          <p>Exposed passwords: {{ exposedPasswordsFound.length }}</p>
        </div>
        <div *ngIf="exposedPasswordsFound.length" class="details">
          <button type="button" (click)="showDetails = true" class="show-details text-btn">
            Show details
          </button>
        </div>
      </div>
    </div>
    <ng-container *ngIf="scanInProgress === false">
      <div *ngIf="exposedPasswordsFound.length; else notFound" class="result warning">
        <div class="status"><i class="pi pi-info-circle"></i>
          Found {{ exposedPasswordsFound.length }} exposed <span [ngPlural]="exposedPasswordsFound.length">
            <ng-template ngPluralCase="=1">&nbsp;password</ng-template>
            <ng-template ngPluralCase="other">&nbsp;passwords</ng-template>
          </span>.
        </div>
      </div>
      <ng-template #notFound>
        <div class="result success">
          <div class="status"><i class="pi pi-check-circle"></i> You're all good.</div>
          <p>No exposed passwords have been found.</p>
        </div>
      </ng-template>
    </ng-container>
    <ng-container *ngIf="scanInProgress">
      <div class="result row">
        <div class="lds-ring"><div></div><div></div><div></div><div></div></div>Scanning... Please wait.
      </div>
    </ng-container>
    <div *ngIf="showDetails && !scanInProgress">
      <div class="table">
        <div class="table-header">
          <div class="row">
            <div>Group</div>
            <div>Title</div>
            <div>Username</div>
            <div>Occurrences</div>
          </div>
        </div>
        <div class="table-body">
          <div *ngFor="let row of exposedPasswordsFound" class="row">
            <div>{{ row.groupName }}</div>
            <div>{{ row.title }}</div>
            <div>{{ row.username }}</div>
            <div>{{ row.occurrences }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer-container">
    <button
      type="button"
      class="text-btn"
      (click)="close()">
      Close
    </button>
  </div>
</app-modal>