<app-modal>
  <div
    class="dialog-header">
    <h2>{{ header }} <small *ngIf="!isReadOnly">in {{ entryGroupName }}</small></h2>
    <a
      href="#"
      role="button"
      aria-label="Close"
      class="close-dialog"
      (click)="close(); false">&times;
    </a>
  </div>
  <div
    #entryForm
    id="entry-form"
    [formGroup]="newEntryForm">
      <div class="inputgroup" [ngClass]="{'readonly': isReadOnly}">
        <span class="inputgroup-addon"><i-feather name="bookmark"></i-feather></span>
        <input
          [attr.aria-invalid]="isControlInvalid(title)"
          aria-describedby="title-invalid"
          type="text"
          [readonly]="isReadOnly"
          id="entry-title"
          #autofocus
          formControlName="title"
          placeholder="Title">   
      </div>
      <div
        *ngIf="isControlInvalid(title)"
        id="title-invalid"
        class="validation-error">
        Title is required
      </div>
      <div
        class="inputgroup required"
        [ngClass]="{'readonly': isReadOnly}">
        <span class="inputgroup-addon"><i-feather name="user"></i-feather></span>
        <input
          type="text"
          [readonly]="isReadOnly"
          id="entry-username"
          formControlName="username"
          placeholder="Username">         
      </div>
      <div formGroupName="passwords" class="form-group">
        <div
          class="inputgroup required pw"
          [ngClass]="{'readonly': isReadOnly}">
          <span class="inputgroup-addon"><i-feather name="key"></i-feather></span>
          <input
            #passwordInput
            [type]="passwordVisible ? 'text' : 'password'"
            [attr.aria-invalid]="isControlInvalid(passwordsGroup.get('password'))"
            aria-describedby="password-invalid"
            [readonly]="isReadOnly"
            id="entry-password"
            class="password"
            formControlName="password"
            placeholder="Password (required)"
            (input)="onPasswordChange($event)">
            <div *ngIf="!isReadOnly; else readonly" class="password-tools">
              <div class="actions">
                <a
                  href="#"
                  appTooltip="Show password"
                  container="body"
                  aria-label="Show password"
                  (click)="togglePasswordVisibility(); false">
                  <i-feather
                    [name]="passwordVisible ? 'eye-off' : 'eye'"
                    [ngClass]="{ active: passwordVisible }">
                  </i-feather>
                </a>
                <a
                  href="#"
                  appTooltip="Generate password"
                  aria-label="Generate password"
                  container="body"
                  (click)="regeneratePassword(); false">
                  <i-feather name="refresh-cw"></i-feather>
                </a>
              </div>
            </div>
            <ng-template #readonly>
              <a href="#" (click)="copyPassword(); false" class="copy-password">Copy</a>
            </ng-template>
        </div>
        <app-password-strength-meter [score]="passwordScore"></app-password-strength-meter>
        <div
          *ngIf="isControlInvalid(passwordsGroup.get('password'))"
          id="password-invalid"
          class="validation-error pw-validation">
          Password is required
        </div>
        <div
          class="inputgroup required" [ngClass]="{'readonly': isReadOnly}">
          <span class="inputgroup-addon"><i-feather name="key"></i-feather></span>
          <input
            #passwordInput
            [readonly]="isReadOnly"
            [attr.aria-invalid]="isControlInvalid(passwordsGroup)"
            aria-describedby="password-repeat-invalid"
            [type]="passwordVisible ? 'text' : 'password'"
            id="entry-password-r"
            formControlName="repeatPassword"
            placeholder="Repeat password (required)">
        </div>
        <div
          *ngIf="isControlInvalid(passwordsGroup)"
          id="password-repeat-invalid"
          class="validation-error">
          Passwords must match
        </div>
      </div>
      <div class="inputgroup" [ngClass]="{'readonly': isReadOnly}">
        <div class="inputgroup-addon"><i-feather name="globe"></i-feather></div>
        <input
          type="text"
          [readonly]="isReadOnly"
          id="entry-website"
          formControlName="url"
          placeholder="Website">
      </div>
      <div class="inputgroup" [ngClass]="{'readonly': isReadOnly}">
        <div class="inputgroup-addon"><i-feather name="info"></i-feather></div>
        <textarea
          formControlName="notes"
          [readonly]="isReadOnly"
          id="entry-note"
          placeholder="Note"
          rows="5">
        </textarea>     
      </div>
      <div>
        <button type="button" class="expandable-section" (click)="isVisible = !isVisible">
          <i-feather [name]="isVisible ? 'chevron-up' : 'chevron-right'"></i-feather>
          Advanced options
        </button>
        <ng-container *ngIf="isVisible">
          <div class="section">
            <label class="label" for="entry-autotype-exp">Autotype target window:</label>
            <div class="inputgroup" [ngClass]="{'readonly': isReadOnly}">
            <div class="inputgroup-addon"><i-feather name="code"></i-feather></div>
              <input
                formControlName="autotypeExp"
                [readonly]="isReadOnly"
                type="text"
                id="entry-autotype-exp"
                placeholder="Regular expression" />  
            </div>
          </div>
        </ng-container>
      </div>
  </div>
  <div class="footer-container">
    <button
      *ngIf="isReadOnly"
      type="button"
      (click)="delete(); false"
      class="text-btn delete">
      <i-feather name="trash"></i-feather>
      Delete
    </button>
    <button
      *ngIf="isReadOnly"
      type="button"
      (click)="restore(); false"
      class="text-btn restore">
      <i-feather name="refresh-ccw"></i-feather>
      Restore
    </button>
    <button
      *ngIf="!isReadOnly; else closeBtn"
      [disabled]="saveLocked"
      (click)="addNewEntry()"
      id="entry-submit"
      class="primary-btn">
      Confirm
    </button>
    <ng-template #closeBtn>
      <button
        type="button"
        (click)="closeReadOnly()"
        id="close"
        class="primary-btn">
      Close
    </button>
    </ng-template>
  </div>
</app-modal>